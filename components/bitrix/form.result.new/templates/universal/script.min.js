BX.namespace("BX.JCWebForm"),function(){"use strict";BX.JCWebForm={init:function(e){this.result=e.result,""!=this.result.FORM_ID.length&&(this.form=document.querySelector("#"+this.result.FORM_ID+" form")),this.openFormInModalWindow=this.result.OPEN_FORM_IN_MODAL_WINDOW,this.formCallButton=document.querySelector("."+this.result.CLASS_FORM_CALL_BUTTON),this.captchaCodeImg=document.querySelector(".universal-form__captcha-code"),this.captchaCodeInput=document.querySelector('[name="captcha_sid"]'),this.pathToAjaxComponent=this.result.PATH_TO_AJAX_COMPONENT,this.pathToAjaxResult=this.result.PATH_TO_AJAX_RESULT,this.successfulResultSeparateWindow=this.result.SUCCESSFUL_RESULT_SEPARATE_WINDOW,this.descriptionSuccessfulResult=this.result.DESCRIPTION_SUCCESSFUL_RESULT,this.titleSuccessfulResult=this.result.TITLE_SUCCESSFUL_RESULT,this.callingForm=this.result.CALLING_FORM,this.submitEventName=this.result.SUBMIT_EVENT_NAME,this.agreementVerified="Y"==this.result.USER_CONSENT,this.lastResult=null,null!=this.form&&(this.webFormId=this.form.querySelector('[name="WEB_FORM_ID"]').value,this.sendFormButton=this.form.querySelector('[type="submit"]'),this.phoneField=this.form.querySelector('[data-validation="telephone"]'),this.useCaptcha=this.result.USE_CAPTCHA,this.error=!1,this.arrayInputs=this.result.INPUTS,this.eventActivation(),this.fieldValidationEvent(this.arrayInputs),this.clearForm(this.arrayInputs)),this.useCaptcha&&null!=this.form&&this.initializeCaptcha(),null!=this.phoneField&&this.setMaskForPhone(this.phoneField),null!=this.formCallButton&&"Y"==this.openFormInModalWindow&&""==this.callingForm.length&&BX.bind(this.formCallButton,"click",BX.proxy(this.callForm,this)),null!=this.sendFormButton&&(BX.bind(this.form,"submit",BX.proxy(this.sendForm,this)),BX.bind(this.sendFormButton,"click",(function(){BX.onCustomEvent(this.submitEventName,[])})))},callForm:function(){BX.ajax.promise({url:this.pathToAjaxComponent,method:"POST",dataType:"html",data:{params:this.result.PARAMETERS,componentName:this.result.COMPONENT_NAME,templateName:this.result.TEMPLATE_NAME,calling_form:!0,useCaptcha:this.useCaptcha}}).then(function(e){let t,s;t=$.parseHTML(e),s=new BX.PopupWindow("form-universal-"+Math.random().toString(16).slice(2),null,{content:t[1],autoHide:!0,offsetTop:1,offsetLeft:0,lightShadow:!0,closeIcon:!0,closeByEsc:!0,className:"popup-form-universal",events:{onAfterPopupShow:function(){s.adjustPosition(),s.resizeOverlay()}},overlay:{backgroundColor:"black",opacity:"80"}}),s.show()}.bind(this)).catch((function(){}))},sendForm:function(e){let t;if(this.error=!1,t=this.formFieldValues(this.arrayInputs),BX.PreventDefault(e),1==this.error||0==this.agreementVerified)return!1;BX.ajax.submitAjax(this.form,{url:this.pathToAjaxResult,method:"POST",dataType:"json",data:{fieldValues:t,webFormId:this.webFormId,arrayInputs:this.arrayInputs},onsuccess:function(e,t){"Y"==this.successfulResultSeparateWindow?("Y"==this.openFormInModalWindow&&this.popupObject.close(),this.popupObjectSuccess=new BX.PopupWindow("universal-form__succesfull-"+Math.random().toString(16).slice(2),null,{content:`<div class="universal-form__icon"><svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 19.5L13.5 25.5L28.5 10.5" stroke="#E85231" stroke-width="2.33333" stroke-linecap="round" stroke-linejoin="round"/></svg></div><div class="universal-form__title">${this.titleSuccessfulResult}</div><div class="universal-form__description">${this.descriptionSuccessfulResult}</div><div class="universal-form__close-button">Ок</div>`,autoHide:!0,offsetTop:1,offsetLeft:0,lightShadow:!0,closeIcon:!0,closeByEsc:!0,className:"universal-form__succesfull universal-form__final-result",overlay:{backgroundColor:"black",opacity:"80"}}),this.popupObjectSuccess.show(),this.popupObjectSuccess.popupContainer.querySelector(".universal-form__close-button").addEventListener("click",(()=>{this.popupObjectSuccess.close()})),"N"==this.openFormInModalWindow&&this.clearForm(e.ARRAY_INPUTS)):(this.clearMessage(),null!=this.lastResult&&this.form.closest(".universal-form").classList.remove(this.lastResult),this.lastResult="universal-form__result_"+e.RESULT,this.form.closest(".universal-form").classList.add(this.lastResult),this.showMessage(e.MESSAGE),this.clearForm(e.ARRAY_INPUTS))}.bind(this),onfailure:function(e,t){"Y"==this.successfulResultSeparateWindow?("Y"==this.openFormInModalWindow&&this.popupObject.close(),this.popupObjectSuccess=new BX.PopupWindow("universal-form__failure-"+Math.random().toString(16).slice(2),null,{content:`<div class="universal-form__icon"><svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.9993 13.5V16.5M17.9993 22.5H18.0143M7.60701 28.5H28.3916C30.701 28.5 32.1444 26 30.9897 24L20.5974 6C19.4427 4 16.5559 4 15.4012 6L5.00894 24C3.85424 26 5.29761 28.5 7.60701 28.5Z" stroke="#5A616C" stroke-width="2.33333" stroke-linecap="round" stroke-linejoin="round"/></svg></div><div class="universal-form__title">${this.titleFailureResult}</div><div class="universal-form__description">${this.descriptionFailureResult}</div><div class="universal-form__close-button">Хорошо</div>`,autoHide:!0,offsetTop:1,offsetLeft:0,lightShadow:!0,closeIcon:!0,closeByEsc:!0,className:"universal-form__failure universal-form__final-result",overlay:{backgroundColor:"black",opacity:"80"}}),this.popupObjectSuccess.show(),this.popupObjectSuccess.popupContainer.querySelector(".universal-form__close-button").addEventListener("click",(()=>{this.popupObjectSuccess.close()})),"N"==this.openFormInModalWindow&&this.clearForm(e.ARRAY_INPUTS)):(this.clearMessage(),this.form.closest(".universal-form").classList.add("universal-form__result_false"),this.showMessage("FORM_TITLE_FALSE"),this.clearForm(e.ARRAY_INPUTS))}.bind(this)})},setMaskForPhone:function(e){IMask(e,{mask:"+{7} (000) 000-00-00"})},initializeCaptcha:function(){try{Recaptchafree.reset()}catch(e){}},formFieldValues:function(e){let t,s=[];for(var i in e){switch(e[i].TYPE){case"hidden":t=this.hiddenFieldValue(e[i],i);break;case"radio":t=this.radioButtonFieldValue(e[i]);break;default:t=this.textFieldValue(e[i]);break}"hidden"==e[i].TYPE&&"radio"==e[i].TYPE||"Y"!=e[i].REQUIRED||this.fieldValidation(t),s[t.name]=t.value,t=""}return s},textFieldValue:function(e){return this.form.querySelector("[name='"+e.DATA_NAME+"']")},radioButtonFieldValue:function(e){let t,s;for(var i in e.ID)t=this.form.querySelector("[id='"+e.ID[i]+"'][name='"+e.DATA_NAME+"']"),t.checked&&(s=t);return s instanceof Element?s:""},hiddenFieldValue:function(e,t){let s=this.form.querySelector("[name='"+e.DATA_NAME+"']");return"PRODUCT"==t&&(s.value=this.result.DATA.NAME+" - "+this.result.DATA.PRICE+" - "+this.form.querySelector(".product-card-count__num").value+"шт\r\nСсылка на товар: "+window.location.protocol+"//"+window.location.hostname+this.result.DATA.SRC_TO_PRODUCT),s},fieldValidation:function(e){let t,s,i,o;i=e.dataset.validation,"telephone"==i&&(t="FORM_REQUIRED_TELEPHONE",o=new RegExp("^((8|\\+7)[\\- ]?)?(\\(?\\d{3}\\)?[\\- ]?)?[\\d\\- ]{7,10}$","gmi")),"email"==i&&(t="FORM_REQUIRED_EMAIL",o=new RegExp("^[A-Z0-9._%+-]+@[A-Z0-9-]+.[A-Z]{2,4}$","gmi")),null!=o&&0!=o.length&&(s=o.test(e.value)),""==e.value.length||!1===s?(this.showErrorForField(e,t),this.error=!0):this.hideErrorForField(e)},showErrorForField:function(e,t="FORM_REQUIRED_FIELDS"){let s=e.parentElement.querySelector(".form-error");if(null!=s&&s.classList.contains("form-error"))return s.innerText=BX.message(t),!1;0==t.length&&(t="FORM_REQUIRED_FIELDS"),e.before(BX.create("SPAN",{props:{className:"form-error"},text:BX.message(t)})),e.classList.add("form-error-field")},hideErrorForField:function(e){let t=e.parentElement.querySelector(".form-error");if(null==t)return!1;t.classList.contains("form-error")&&e.parentElement.querySelector(".form-error").remove(),e.classList.remove("form-error-field")},eventActivation:function(){if(BX.UserConsent){let e=BX.UserConsent.load(this.form);if(!e)return;BX.addCustomEvent(e,BX.UserConsent.events.save,BX.proxy((function(e){this.agreementVerified=!1}),this)),BX.addCustomEvent(e,BX.UserConsent.events.refused,BX.proxy((function(e){this.agreementVerified=!0}),this))}},fieldValidationEvent:function(e){let t;for(var s in e)"hidden"!=e[s].TYPE&&"radio"!=e[s].TYPE&&(t=document.querySelector("[name='"+e[s].DATA_NAME+"']"),BX.bind(t,"input",this.fieldEmpty))},fieldEmpty:function(e){null!=event&&(e=event.target),""==e.value.length?e.parentNode.classList.remove("universal-form__field-not-empty"):e.parentNode.classList.add("universal-form__field-not-empty")},clearForm:function(e){let t;for(var s in e)"hidden"!=e[s].TYPE&&"radio"!=e[s].TYPE&&(t=document.querySelector("[name='"+e[s].DATA_NAME+"']"),t.value="")},showMessage:function(e){this.form.before(BX.create("DIV",{props:{className:"universal-form__message"},text:BX.message(e)}))},clearMessage:function(){let e=this.form.previousElementSibling;null!=e&&e.remove()},refreshCaptcha:function(e){this.captchaCodeImg.src="/bitrix/tools/captcha.php?captcha_sid="+e,this.captchaCodeInput.value=e},resultConsentProcessingPersonalData:function(){let e;return e=document.querySelector(".universal-form__agreement input"),e.checked}}}();
